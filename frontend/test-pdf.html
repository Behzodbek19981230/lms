<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Test</title>
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>
    <h1>PDF Generator Test</h1>
    <button onclick="generatePDFFromTxt()">TXT dan PDF yaratish</button>
    <button onclick="generateSamplePDF()">Sample PDF yaratish</button>
    
    <script>
        function generateSamplePDF() {
            const { jsPDF } = window.jspdf;
            
            // Sample exam data
            const examData = {
                title: "imtihon-2 — Variant 2025-002-003-01",
                variantNumber: "2025-002-003-01", 
                studentName: "John Doe",
                date: new Date().toLocaleDateString(),
                questions: [
                    {
                        number: 1,
                        text: "(2^3) * (2^2) nechaga teng?",
                        answers: ["A) 4", "B) 32", "C) 16", "D) 8"],
                        points: 1
                    },
                    {
                        number: 2,
                        text: "9 * 6 nechaga teng?",
                        answers: ["A) 54", "B) 52", "C) 45", "D) 64"],
                        points: 1
                    },
                    {
                        number: 3,
                        text: "15 / 3 nechaga teng?",
                        answers: ["A) 4", "B) 6", "C) 5", "D) 7"],
                        points: 1
                    }
                ]
            };
            
            // Create PDF
            const doc = new jsPDF({
                format: 'a4',
                unit: 'mm',
            });
            
            let yPos = 20;
            const margin = 20;
            const pageWidth = doc.internal.pageSize.getWidth();
            
            // Header
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text(examData.title, pageWidth / 2, yPos, { align: 'center' });
            yPos += 10;
            
            doc.setFontSize(12);
            doc.text(`Variant: ${examData.variantNumber}`, pageWidth / 2, yPos, { align: 'center' });
            yPos += 15;
            
            // Line
            doc.line(margin, yPos, pageWidth - margin, yPos);
            yPos += 10;
            
            // Student info
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('Student ma\'lumotlari:', margin, yPos);
            yPos += 7;
            
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text(`Ism-familiya: ${examData.studentName}`, margin + 5, yPos);
            yPos += 5;
            doc.text(`Variant: ${examData.variantNumber}`, margin + 5, yPos);
            yPos += 5;
            doc.text(`Sana: ${examData.date}`, margin + 5, yPos);
            yPos += 15;
            
            // Questions
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('SAVOLLAR:', margin, yPos);
            yPos += 10;
            
            examData.questions.forEach((question) => {
                // Question
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                const questionText = `${question.number}. ${question.text}`;
                doc.text(questionText, margin, yPos);
                yPos += 7;
                
                // Points
                if (question.points) {
                    doc.setFontSize(9);
                    doc.setFont('helvetica', 'italic');
                    doc.text(`[${question.points} ball]`, pageWidth - margin - 15, yPos - 7);
                }
                
                // Answers
                question.answers.forEach((answer) => {
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'normal');
                    doc.text(answer, margin + 10, yPos);
                    yPos += 5;
                });
                
                yPos += 5;
            });
            
            // Footer
            doc.setFontSize(8);
            doc.text('Universal LMS • Generated with jsPDF', pageWidth / 2, 285, { align: 'center' });
            
            // Save
            doc.save('Sample_Exam_Variant.pdf');
            console.log('PDF generated successfully!');
        }
        
        function generatePDFFromTxt() {
            // Read the TXT file content (you would get this from the server)
            const txtContent = `====================
PDF DOCUMENT (FALLBACK MODE)
====================

Document Title: imtihon-2 — Variant 2025-002-003-01
Variant Number: 2025-002-003-01
Student Name: John Doe
Generated on: 01/09/2025 12:51:55
Status: Generated in fallback mode due to system limitations

====================
DOCUMENT CONTENT
====================

Total Questions: 10

Question 1:
  Text: (2^3) * (2^2) nechaga teng?
  Answers:
    A) A) 4
    B) B) 32
    C) C) 16
    D) D) 8

Question 2:
  Text: 9 * 6 nechaga teng?
  Answers:
    A) A) 54
    B) B) 52
    C) C) 45
    D) D) 64

Question 3:
  Text: 15 / 3 nechaga teng?
  Answers:
    A) A) 4
    B) B) 6
    C) C) 5
    D) D) 7`;
            
            // Parse and generate PDF
            const examData = parseTxtContent(txtContent);
            generateExamPDF(examData);
        }
        
        function parseTxtContent(txtContent) {
            const lines = txtContent.split('\n');
            
            const examData = {
                title: '',
                variantNumber: '',
                studentName: '',
                date: new Date().toLocaleDateString(),
                questions: []
            };
            
            // Extract basic info
            lines.forEach(line => {
                if (line.startsWith('Document Title:')) {
                    examData.title = line.replace('Document Title:', '').trim();
                } else if (line.startsWith('Variant Number:')) {
                    examData.variantNumber = line.replace('Variant Number:', '').trim();
                } else if (line.startsWith('Student Name:')) {
                    examData.studentName = line.replace('Student Name:', '').trim();
                }
            });
            
            // Extract questions
            let currentQuestion = null;
            let inAnswers = false;
            
            lines.forEach(line => {
                const trimmedLine = line.trim();
                
                if (trimmedLine.startsWith('Question ') && trimmedLine.endsWith(':')) {
                    // Save previous question
                    if (currentQuestion) {
                        examData.questions.push(currentQuestion);
                    }
                    
                    // Start new question
                    const questionMatch = trimmedLine.match(/Question (\d+):/);
                    if (questionMatch) {
                        currentQuestion = {
                            number: parseInt(questionMatch[1]),
                            text: '',
                            answers: []
                        };
                        inAnswers = false;
                    }
                } else if (trimmedLine.startsWith('Text:') && currentQuestion) {
                    currentQuestion.text = trimmedLine.replace('Text:', '').trim();
                } else if (trimmedLine === 'Answers:') {
                    inAnswers = true;
                } else if (inAnswers && trimmedLine.match(/^[A-D]\)/) && currentQuestion) {
                    currentQuestion.answers.push(trimmedLine);
                }
            });
            
            // Add last question
            if (currentQuestion) {
                examData.questions.push(currentQuestion);
            }
            
            return examData;
        }
        
        function generateExamPDF(examData) {
            console.log('Generating PDF from parsed data:', examData);
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                format: 'a4',
                unit: 'mm',
            });
            
            let yPos = 20;
            const margin = 20;
            const pageWidth = doc.internal.pageSize.getWidth();
            const maxWidth = pageWidth - 2 * margin;
            
            // Header
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text(examData.title || 'IMTIHON', pageWidth / 2, yPos, { align: 'center' });
            yPos += 10;
            
            doc.setFontSize(12);
            doc.text(`Variant: ${examData.variantNumber}`, pageWidth / 2, yPos, { align: 'center' });
            yPos += 15;
            
            // Line
            doc.line(margin, yPos, pageWidth - margin, yPos);
            yPos += 10;
            
            // Student info
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('Student ma\'lumotlari:', margin, yPos);
            yPos += 7;
            
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text(`Ism-familiya: ${examData.studentName || '__________________'}`, margin + 5, yPos);
            yPos += 5;
            doc.text(`Variant: ${examData.variantNumber}`, margin + 5, yPos);
            yPos += 5;
            doc.text(`Sana: ${examData.date}`, margin + 5, yPos);
            yPos += 15;
            
            // Questions
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('SAVOLLAR:', margin, yPos);
            yPos += 10;
            
            examData.questions.forEach((question) => {
                // Check new page
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }
                
                // Question
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                const questionPrefix = `${question.number}. `;
                doc.text(questionPrefix, margin, yPos);
                
                const questionTextX = margin + doc.getTextWidth(questionPrefix) + 2;
                const questionLines = doc.splitTextToSize(question.text, maxWidth - questionTextX + margin);
                
                doc.setFont('helvetica', 'normal');
                doc.text(questionLines, questionTextX, yPos);
                yPos += questionLines.length * 5 + 3;
                
                // Answers
                if (question.answers && question.answers.length > 0) {
                    question.answers.forEach((answer) => {
                        doc.setFontSize(10);
                        doc.text(answer, margin + 10, yPos);
                        yPos += 5;
                    });
                }
                
                yPos += 5;
            });
            
            // Footer
            doc.setFontSize(8);
            doc.text(`Universal LMS • ${examData.date} • Generated from TXT`, pageWidth / 2, 285, { align: 'center' });
            
            // Save
            const fileName = `${examData.title.replace(/[^a-zA-Z0-9]/g, '_')}_PDF.pdf`;
            doc.save(fileName);
            console.log('PDF generated from TXT successfully!');
        }
    </script>
</body>
</html>
